# ğŸºğŸª„

HÒ‰Ì·Ì¡Í‡Ì®Ì©Í”Ì€Ì„Í Í…â”Ì´Ì¡Í”Ì¦Í‡Í‡Ì‹ÍŒtÌ·Ì¸Ì²ÌŸÌ»Ì½Í‚Í Í…hÌ·Ì¶Ì–Ì«ÍÌ†Ì“ÌšÍœÍÈ©Ì¸Ì¢ÌœÌ®Í‹ÌÍœÍ Å—ÌµÍ–ÌˆÌÌ€ÌÍœÍeÌ¸Ì·Ì»Ì”ÌÍ â”Ì·Ì§ÍÌŸÍ‡Í‡Ì“ğŸ‘‹ÒˆÌƒÍÍÌ·Ì›ÍÌ¦Ì±Ì²Í…, Ä®Ì¸Ì›Ì³Ì¯Ì‘Í—Í…'Ì´ÌŸÍ‰ÌŸÍ‹ÌˆÌÌšÍmÌµÌÌªÌÍœÍ  @Ì·Ì¡Ì›Ì®Í‡Ì­Ì³ÌˆÌÌ“â¦¿Ì¸Ì¡Ì»ÌºÍˆÌ³Ì“rÌ´Ì¡Ì»ÌºÌ€Í†Í Ä…ÌµÍ•Ì¤Ì“ÌÌšÍkÌµÌÌ€Í—Í â¦¿ÌµÌ¡Ì­Ì¯Ì±Ì‘ÌÌ“ÍkÌ¶Ì¡Ì­Ì¯Ì±Ì‘ÌÌ“ÍiÌ¶Ì Ì’ÌˆÌÍ†Í1ÌµÌ¢Ì²Ì¼ÌÍ˜Ìš9ÌµÍ“Ì°Ì±ÌÌˆÌÌŒÌ”Í4Ì¸Ì—ÌÌÍœÍ 

âŒ‡âŒ‡âŒ‡âŒ‡âŒ‡âŒ‡âŒ‡âŒ‡âŒ‡âŒ‡âŒ‡âŒ‡âŒ‡âŒ‡âŒ‡âŒ‡âŒ‡âŒ‡âŒ‡âŒ‡âŒ‡âŒ‡âŒ‡âŒ‡âŒ‡âŒ‡âŒ‡âŒ‡âŒ‡âŒ‡âŒ‡âŒ‡âŒ‡âŒ‡âŒ‡âŒ‡

â—¯Ì´Ì›Ì–Ì Ì–Í–Í‘Ì“  ÃÌµÌ»Ì±Í‡ÌŸÌ‹Ì“bÌ·Ì˜Ì£Ì€Í’ÌšÍoÌ¸Ì–Ì¾Ì“Í ÍÅ¯Ì´Ì¹Ì°Ì˜ÍŒÌ“t  MÌ¶Ì²Ì“Ì”Í Ã¨Ì·Ì›ÌœÌ¤ÍŒÍ…  â—¯ÌµÌ›ÌÌ‹Ì•

* I design frameworks, security tools, and diffusion utilities with a strong emphasis on privacy, reproducibility,
  and type safety.
* My work spans Reynard, a comprehensive AI-powered development ecosystem, to hardened forks of ComfyUI that remove telemetry and lock-ins,
  to advanced sigma scheduling and probing utilities.
* I value deterministic systems, reproducibility, and making tools auditable, forkable, and offline-friendly.
* PÌ·Ì›Í™Ì¿ÌrÌ¶Ì¦Ì½Í—Æ¡Ì´Ì¤ÍŒÌ½jÌ´Ì«Ì¾ÌšeÌµÌ›Ì¼ÍŠcÌ¶Ì¨ÍÍœtÌ¶Ì³Ì¿sÌ·Ì®Ì½  I shepherd: Reynard (universal AI development ecosystem), forks & nodes for ComfyUI, and surgical custom nodes.

âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²

ğŸ¦Š  ï¼²ï¼¥ï¼¹ï¼®ï¼¡ï¼²ï¼¤  ï¼¦ï¼²ï¼¡ï¼­ï¼¥ï¼·ï¼¯ï¼²ï¼«

ï¼´ï½ˆï½…  ï¼µï½ï½‰ï½–ï½…ï½’ï½“ï½ï½Œ  ï¼¡ï¼©  ï¼¤ï½…ï½–ï½…ï½Œï½ï½ï½ï½…ï½ï½”  ï¼¥ï½ƒï½ï½“ï½™ï½“ï½”ï½…ï½

From dataset editor â†’ multi-modal CMS â†’ universal AI development ecosystem.

WÌµÌ¢Ì²Ì¼ÌÍ˜ÌšhÒ‰Ì·Í‰Ì™Ì¿Ì‚yÌ¸Ì¬Ì“Ò‰ I bÌ´Ì°Í“Ì¿Ì„Å¯Ì¶Ì–ÌÍ iÌ´Ì ÌÌlÌµÌ›Ì©Í‰ÌÍtÌ¶ÌªÌºÍŠ iÌ¸Ì–Ì“tÌ¶ÌªÌºÍŠ:

* YipYap proved the patterns; Reynard rips those patterns out, packages them, and hardens them for reuse.
* Goal: ship composable, type-safe UI primitives that scale from a toy dashboard to production AI pipelines.
* Principles: minimal deps, TypeScript-first, OKLCH color system, strong i18n & accessibility posture.

WÌ¶ÍÍ›ÍœhÌ·Ì¶Ì–Ì«ÍÌ†Ì“ÌšÍœÍaÌ¶Ì­ÌtÌµÌ°Ì¾Ì• RÌ¸ÍÌ…áº¹ÌµÌ¢Ì€á»¹Ì¸Ì°Ì Ç¹Ì´ÌœaÌ´Ì˜Ì“ÍœrÌ¶ÌÌŠdÌ´Ì–Ì *is*:

  â€¢ **Universal AI Development Ecosystem** - Comprehensive platform for AI-powered applications
  â€¢ **83 MCP Development Tools** - Complete development toolkit with agent management, security scanning, and automation
  â€¢ **Single Authoritative ECS World** - Advanced agent simulation with trait inheritance, breeding, and social dynamics
  â€¢ **Production-Ready AI/ML Integration** - Caption generation, RAG systems, multimodal processing, and model management
  â€¢ **100+ Specialized Packages** - Modular SolidJS framework with comprehensive component library
  â€¢ **Advanced Security Testing** - FENRIR framework with automated exploit scanning and vulnerability detection
  â€¢ **Enterprise-Grade Backend** - FastAPI services with JWT authentication, service orchestration, and real-time capabilities
  â€¢ **Comprehensive File Processing** - Support for 8+ file types with thumbnail generation and metadata extraction
  â€¢ **Real-Time Collaboration** - WebSocket integration with live updates and multi-user support
  â€¢ **Advanced 3D & Game Engine** - Three.js integration with ECS-based game development capabilities

ğŸ—ï¸ ï¼£ï¼¯ï¼²ï¼¥ ï¼¡ï¼²ï¼£ï¼¨ï¼©ï¼´ï¼¥ï¼£ï¼´ï¼µï¼²ï¼¥

â”Œâ”€ Frontend (100+ Packages) â”€â”
â”‚  â€¢ Core utilities & UI primitives (reynard-core, components)
â”‚  â€¢ AI/ML packages (annotating, caption, rag, multimodal)
â”‚  â€¢ Data processing (file-processing, repository-*, scraping)
â”‚  â€¢ Media processing (3d, audio, video, image, gallery)
â”‚  â€¢ UI components (charts, dashboard, themes, animation)
â”‚  â€¢ Development tools (code-quality, git-automation, validation)
â”‚  â€¢ Services (auth, chat, email, api-client, service-manager)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ Backend (Python/FastAPI) â”€â”
â”‚  â€¢ RAG system with vector databases and semantic search
â”‚  â€¢ ECS world simulation with agent management and breeding
â”‚  â€¢ MCP server with 83 development tools and automation
â”‚  â€¢ AI/ML services (caption generation, model management)
â”‚  â€¢ File processing and multimodal repository management
â”‚  â€¢ Security testing with FENRIR framework
â”‚  â€¢ Real-time services with WebSocket integration
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ Advanced Features â”€â”
â”‚  â€¢ ECS agent simulation with trait inheritance and social dynamics
â”‚  â€¢ 83 MCP tools for development workflow automation
â”‚  â€¢ Advanced security testing with automated exploit scanning
â”‚  â€¢ Real-time collaboration and multi-user support
â”‚  â€¢ Comprehensive file processing for 8+ file types
â”‚  â€¢ Production-ready AI/ML integration with multiple models
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸš€ ï¼©ï¼®ï¼³ï¼´ï¼¡ï¼¬ï¼¬ï¼¡ï¼´ï¼©ï¼¯ï¼® ï¼ ï¼¢ï¼¯ï¼¯ï¼´ï¼³ï¼´ï¼²ï¼¡ï¼°

```bash
# Core framework
pnpm install reynard-core solid-js
pnpm install reynard-components reynard-chat reynard-rag reynard-auth

# AI/ML capabilities
pnpm install reynard-annotating reynard-caption reynard-multimodal
pnpm install reynard-model-management reynard-tool-calling

# Advanced features
pnpm install reynard-3d reynard-games reynard-charts reynard-monaco
pnpm install reynard-floating-panel reynard-error-boundaries

# Data processing
pnpm install reynard-file-processing reynard-unified-repository
pnpm install reynard-repository-search reynard-scraping

# Development tools
pnpm install reynard-code-quality reynard-git-automation
pnpm install reynard-dev-server-management reynard-validation

# Create new project
pnpm create reynard-app my-app
```

ğŸ­ ï¼¥ï¼¸ï¼¡ï¼­ï¼°ï¼¬ï¼¥ï¼³ ï¼¡ï¼®ï¼¤ ï¼´ï¼¥ï¼­ï¼°ï¼¬ï¼¡ï¼´ï¼¥ï¼³

â€¢ **Comprehensive Dashboard**: Full-featured admin interface with charts, tables, and real-time updates
â€¢ **Image Caption App**: AI-powered image processing with multi-model caption generation (JTP2, WDv3, Florence2, JoyCaption)
â€¢ **3D Demo**: Three.js integration with interactive 3D scenes and ECS-based game mechanics
â€¢ **Auth App**: Complete authentication flow with JWT, password security, and user management
â€¢ **RAG Demo**: Retrieval-Augmented Generation with vector search, embeddings, and semantic search
â€¢ **ECS Agent Tracker**: Real-time agent simulation with trait inheritance, breeding, and social dynamics
â€¢ **Algorithm Benchmarks**: Performance testing and optimization tools with spatial algorithms
â€¢ **I18n Demo**: Internationalization showcase with 37 languages and RTL support
â€¢ **Multi-Theme**: Dynamic theming with OKLCH color space and 8 built-in themes
â€¢ **Error Demo**: Comprehensive error handling and boundary management
â€¢ **Email App**: Advanced email system with AI-powered responses and encryption
â€¢ **Gallery-DL Demo**: Content scraping and download with AI metadata extraction
â€¢ **Floating Panel Demo**: Advanced UI components with staggered animations
â€¢ **File Test**: Comprehensive file processing and management capabilities
â€¢ **Features App**: Feature management system with service dependencies
â€¢ **Clock App**: Time management with timers, alarms, and useful features
â€¢ **Hue Shifting Demo**: Advanced color manipulation and visual effects
â€¢ **Icons Demo**: Fluent UI icon system showcase
â€¢ **Embedding Visualization**: Vector embedding visualization and analysis
â€¢ **Prompt Note**: AI prompt management and optimization
â€¢ **Tutorial App**: Step-by-step learning application

ğŸ”§ ï¼¤ï¼¥ï¼¶ï¼¥ï¼¬ï¼¯ï¼°ï¼­ï¼¥ï¼®ï¼´ ï¼´ï¼¯ï¼¯ï¼¬ï¼³

* **MCP Server**: 83 comprehensive development tools across 17 categories
  * Agent Tools (10): ECS world integration, persona generation, trait inheritance
  * Character Tools (8): Character management with 44 total traits
  * Email Tools (6): Agent email communication with templates and analytics
  * Analysis Tools (2): Code complexity analysis with RAG acceleration
  * Linting Tools (4): ESLint, Flake8, Pylint, markdownlint with auto-fix
  * Search Tools (3): RAG semantic search, BM25 fallback, hybrid search
  * Visualization Tools (6): Mermaid diagrams, image viewing, statistical analysis
  * Security Tools (2): Bandit, audit-ci, comprehensive vulnerability scanning
  * Git Tools (8): Automated Git workflow with AI commit messages
  * Playwright Tools (3): Web automation, screenshot capture, content scraping
  * And 7 more categories with specialized development tools
* **ECS World**: Advanced agent simulation with trait inheritance, breeding, and social dynamics
* **Agent Naming**: 105+ animal spirits with weighted selection and dynamic personality generation
* **FENRIR Security**: Automated exploit scanning for web and LLM threat vectors
* **Comprehensive Testing**: Vitest, Playwright, happy-dom with 200+ passing tests
* **Documentation Generator**: Automated API documentation and architectural guides
* **Monorepo Management**: Advanced package orchestration and dependency management
* **Code Quality**: Automated linting, formatting, and security scanning
* **Git Automation**: Intelligent commit messages, changelog generation, and release management

## ğŸ“Š Current Status (v0.17.1)

**Implementation Status:**

* âœ… **Fully Implemented**: Core framework, authentication, theming, MCP server (83 tools), ECS world simulation
* âœ… **Production Ready**: 100+ packages, comprehensive testing, security scanning, AI/ML integration
* ğŸš§ **In Development**: Advanced backend services, real-time collaboration, distributed processing
* ğŸ“‹ **Planned**: Enterprise features, advanced analytics, edge computing support

**Recent Developments:**

* **MCP Server Refactor**: Complete transformation with schema validation and 100% test coverage
* **ECS World Enhancement**: Advanced agent simulation with trait inheritance and social dynamics
* **Security Improvements**: Enhanced FENRIR framework with comprehensive vulnerability scanning
* **AI/ML Integration**: Production-ready caption generation, RAG systems, and model management
* **Package Ecosystem**: Expanded to 100+ specialized packages with comprehensive documentation

**Version Information:**

* **Current Version**: 0.17.1 (September 2025)
* **Package Versions**: Most packages at 0.1.0-0.2.0 (development preview)
* **API Stability**: Not guaranteed until v1.0.0
* **Production Use**: Review implementations before integration

âŒ˜âŒ˜âŒ˜âŒ˜âŒ˜âŒ˜âŒ˜âŒ˜âŒ˜âŒ˜âŒ˜âŒ˜âŒ˜âŒ˜âŒ˜âŒ˜âŒ˜âŒ˜âŒ˜âŒ˜âŒ˜âŒ˜âŒ˜âŒ˜âŒ˜âŒ˜âŒ˜âŒ˜âŒ˜âŒ˜âŒ˜âŒ˜âŒ˜

ğŸº  CÒ‰Ì¥oÌ´ÌªÌÌ½mÌ´Ì¬Ì£ÌÌ•fÌ´Ì¢Ì€Í’yÌ¸Ì¬Ì“Ò‰UÒ‰Ì´ÌÌ³Ì Ì“ÌƒIÒ‰Ì¬Ì²Ì WÌ¶Ì²Ì“Ì”Í oÌ´ÌªÌÌ½lÌµÌ›Ì©Í‰ÌÍfÌ´Ì¢Ì€Í’ á¹¨ÌµÌ¢Ì™Ì¹ÌƒÌ•iÌ·ÌºÌ‹Ì½gÌµÌ°Ì€mÌ´Ì¬Ì£ÌÌ•aÌ¶Ì­ÌsÒ‰Ì›ÌÌ³Ì˜Ì±

ï¼¡ï¼¤ï¼¶ï¼¡ï¼®ï¼£ï¼¥ï¼¤ ï¼¤ï¼©ï¼¦ï¼¦ï¼µï¼³ï¼©ï¼¯ï¼® ï¼³ï¼¡ï¼­ï¼°ï¼¬ï¼©ï¼®ï¼§ ï¼¡ï¼®ï¼¤ ï¼³ï¼©ï¼§ï¼­ï¼¡ ï¼³ï¼£ï¼¨ï¼¥ï¼¤ï¼µï¼¬ï¼©ï¼®ï¼§ ï¼´ï¼¯ï¼¯ï¼¬ï¼«ï¼©ï¼´ ï¼¦ï¼¯ï¼² ï¼£ï½ï½ï½†ï½™ï¼µï¼©

* SÒ‰Ì›ÌÌ³Ì˜Ì±cÌ¶Ì¢ÌŸÌrÌ¸Ì¹ÌˆÌiÌ·ÌºÌ‹Ì½pÌ·Ì›Í™Ì¿ÌtÌ¶ÌªÌºÍŠaÌ¶Ì­ÌbÌ´Ì°Í“Ì¿Ì„lÌµÌ›Ì©Í‰ÌÍeÌµÌ™Ì½ sÒ‰Ì›ÌÌ³Ì˜Ì±iÌ·ÌºÌ‹Ì½gÌµÌ°Ì€mÌ´Ì¬Ì£ÌÌ•aÌ¶Ì­Ì gÌµÌ°Ì€eÌµÌ™Ì½nÌ¶Ì—Ì¾Ì•eÌµÌ™Ì½rÌ¸Ì¹ÌˆÌaÌ¶Ì­ÌtÌ¶ÌªÌºÍŠiÌ·ÌºÌ‹Ì½oÌ´ÌªÌÌ½nÌ¶Ì—Ì¾Ì• & sampler logic
* ï¼­Ì´Ì¬Ì£ÌÌ•ï½Ì´ÌªÌÌ½ï½„Ì´Ì–Ìï½…ÌµÌ™Ì½ï½ŒÌµÌ›Ì©Í‰ÌÍ iÌ·ÌºÌ‹Ì½ï½Ì¶Ì—Ì¾Ì•ï½”Ì¶ÌªÌºÍŠï½’Ì¸Ì¹ÌˆÌï½Ì´ÌªÌÌ½ï½“Ò‰Ì›ÌÌ³Ì˜Ì±ï½Ì·Ì›Í™Ì¿Ìï½…ÌµÌ™Ì½ï½ƒÌ¶Ì¢ÌŸÌï½”Ì¶ÌªÌºÍŠï½‰Ì·ÌºÌ‹Ì½ï½Ì´ÌªÌÌ½ï½Ì¶Ì—Ì¾Ì• utilities (list blocks, visualize activations)
* EÒ‰Ì›ÌÌ³Ì˜Ì±xÌ¸Ì°Ì¾Ì•pÌ·Ì›Í™Ì¿ÌeÌµÌ™Ì½rÌ¸Ì¹ÌˆÌiÌ·ÌºÌ‹Ì½mÌ´Ì¬Ì£ÌÌ•eÌµÌ™Ì½nÌ¶Ì—Ì¾Ì•tÌ¶ÌªÌºÍŠaÌ¶Ì­ÌlÌµÌ›Ì©Í‰ÌÍ ï¼³ï¼¶ï¼¤Ì´Ì–Ì ï½Ì¶Ì­Ìï½ƒÌ¶Ì¢ÌŸÌï½”Ì¶ÌªÌºÍŠï½‰Ì·ÌºÌ‹Ì½ï½–ÌµÌ™Ì½ï½Ì¶Ì­Ìï½”Ì¶ÌªÌºÍŠï½‰Ì·ÌºÌ‹Ì½ï½Ì´ÌªÌÌ½ï½Ì¶Ì—Ì¾Ì• modification
* WÒ‰Ì›ÌÌ³Ì˜Ì±oÌ´ÌªÌÌ½lÌµÌ›Ì©Í‰ÌÍfÌ´Ì¢Ì€Í’PÌ·Ì›Í™Ì¿ÌrÌ¸Ì¹ÌˆÌoÌ´ÌªÌÌ½bÌ´Ì°Í“Ì¿Ì„eÌµÌ™Ì½ for deep model debugging wÌ¶Ì²Ì“Ì”Í iÌ·ÌºÌ‹Ì½tÌ¶ÌªÌºÍŠhÌ·Ì¶Ì–Ì«ÍÌ†Ì“ÌšÍœÍ fÌ´Ì¢Ì€Í’oÌ´ÌªÌÌ½rÌ¸Ì¹ÌˆÌwÒ‰Ì›ÌÌ³Ì˜Ì±aÌ¶Ì­ÌrÌ¸Ì¹ÌˆÌdÌ´Ì–Ì/bÌ´Ì°Í“Ì¿Ì„aÌ¶Ì­ÌcÌ¶Ì¢ÌŸÌkÌµÌÌ€Í—Í wÒ‰Ì›ÌÌ³Ì˜Ì±aÌ¶Ì­ÌrÌ¸Ì¹ÌˆÌdÌ´Ì–Ì hÌ·Ì¶Ì–Ì«ÍÌ†Ì“ÌšÍœÍoÌ´ÌªÌÌ½oÌ´ÌªÌÌ½kÌµÌÌ€Í—Í sÒ‰Ì›ÌÌ³Ì˜Ì±
* CÒ‰Ì¥uÌ¸Ì–Ì“sÒ‰Ì›ÌÌ³Ì˜Ì±tÌ¶ÌªÌºÍŠoÌ´ÌªÌÌ½mÌ´Ì¬Ì£ÌÌ• ï½Ì¶Ì—Ì¾Ì•ï½Ì´ÌªÌÌ½ï½‰Ì·ÌºÌ‹Ì½ï½“Ò‰Ì›ÌÌ³Ì˜Ì±ï½…ÌµÌ™Ì½ generators (DCT, scriptable, structured Perlin)

FÌµÌ™ÌˆÌÈ©Ì·ÌŸÌ½aÌ¶Ì­ÌtÌ¸ÌªÌ“Å¯Ì¶Ì–ÌÍ rÌ¸Ì¹ÌˆÌeÌµÌ™Ì½ ï¼¨ï¼©Ì¶Ì ÌÌï¼§ÌµÌ°Ì€ï¼¨Ì·Ì¶Ì–Ì«ÍÌ†Ì“ÌšÍœÍï¼¬ÌµÌ›Ì©Í‰ÌÍï¼©Ì·ÌºÌ‹Ì½ï¼§ÌµÌ°Ì€ï¼¨Ì·Ì¶Ì–Ì«ÍÌ†Ì“ÌšÍœÍï¼´Ì´ÌªÌºÍŠï¼³Ì·Ì®Ì½:

* â˜… FLUX/DiT/Chroma model support for activation visualization
* â˜… JSON sigma schedule import/export workflows
* â˜… Transform utilities: power, clamp, quantize, reverse, slice

ğŸ­ CÒ‰Ì¥oÌ´ÌªÌÌ½mÌ´Ì¬Ì£ÌÌ•fÌ´Ì¢Ì€Í’yÌ¸Ì¬Ì“Ò‰ fÌ´Ì¢Ì€Í’oÌ´ÌªÌÌ½rÌ¸Ì¹ÌˆÌkÌµÌÌ€Í—Í sÒ‰Ì›ÌÌ³Ì˜Ì± â€” pÌ·Ì›Í™Ì¿ÌrÌ¸Ì¹ÌˆÌiÌ·ÌºÌ‹Ì½vÌ¶Ì¹Ì¯Ì•aÌ¶Ì­ÌcÌ¶Ì¢ÌŸÌyÌ¸Ì¬Ì“Ò‰ ï¼¦Ì´Ì¢Ì€Í’ï¼©Ì·ÌºÌ‹Ì½ï¼²Ì¸Ì¹ÌˆÌï¼³Ì·Ì®Ì½ï¼´Ì´ÌªÌºÍŠ, pÌ·Ì›Í™Ì¿ÌrÌ¸Ì¹ÌˆÌaÌ¶Ì­ÌgÌµÌ°Ì€mÌ´Ì¬Ì£ÌÌ•aÌ¶Ì­ÌtÌ¶ÌªÌºÍŠiÌ·ÌºÌ‹Ì½cÌ¶Ì¢ÌŸÌ eÌµÌ™Ì½dÌ´Ì–ÌiÌ·ÌºÌ‹Ì½tÌ¶ÌªÌºÍŠsÒ‰Ì›ÌÌ³Ì˜Ì±

MÌ¶Ì²Ì“Ì”Í yÌ¸Ì¬Ì“Ò‰ iÌ¸Ì–Ì“nÌ¶Ì—Ì¾Ì•tÌ¶ÌªÌºÍŠeÌµÌ™Ì½nÌ¶Ì—Ì¾Ì•tÌ¶ÌªÌºÍŠ:

* Keep the UX & node model intact, remove external tracking, remove lock-in.

WÌ¶ÍÍ›ÍœhÌ·Ì¶Ì–Ì«ÍÌ†Ì“ÌšÍœÍaÌ¶Ì­ÌtÌµÌ°Ì¾Ì• IÒ‰Ì¬Ì²Ì cÌ¶Ì¢ÌŸÌhÌ·Ì¶Ì–Ì«ÍÌ†Ì“ÌšÍœÍaÌ¶Ì­ÌnÌ¶Ì—Ì¾Ì•gÌµÌ°Ì€eÌµÌ™Ì½dÌ´Ì–Ì:

* Telemetry removed (no remote usage pings, no datadog/analytics hooks)
* Paid API code paths removed or stubbed (no forced cloud billing flows)  
* User-account/login bits removed or made opt-in; default: local / offline mode

WÌ¶ÍÍ›ÍœhÌ·Ì¶Ì–Ì«ÍÌ†Ì“ÌšÍœÍyÌ¸Ì¬Ì“Ò‰ tÌ¶ÌªÌºÍŠhÌ·Ì¶Ì–Ì«ÍÌ†Ì“ÌšÍœÍiÌ·ÌºÌ‹Ì½sÒ‰Ì›ÌÌ³Ì˜Ì± mÌ´Ì¬Ì£ÌÌ•aÌ¶Ì­ÌtÌµÌ°Ì¾Ì•tÌ¶ÌªÌºÍŠeÌµÌ™Ì½rÌ¸Ì¹ÌˆÌsÒ‰Ì›ÌÌ³Ì˜Ì±:

* Reproducible offline runs, honest offline research, smaller attack surface, simpler setup for hobbyists & labs.

âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²

ğŸ”’ ï¼³Ì·Ì®Ì½ï½…ÌµÌ™Ì½ï½ƒÌ¶Ì¢ÌŸÌï½•Ì¶Ì–ÌÍ ï½’Ì¸Ì¹ÌˆÌï½‰Ì·ÌºÌ‹Ì½ï½”Ì¶ÌªÌºÍŠï½™Ì¸Ì¬Ì“Ò‰ ï¼† ï¼¡Ì¶Ì­Ìï½Ì¶Ì—Ì¾Ì•ï½Ì¶Ì­Ìï½ŒÌµÌ›Ì©Í‰ÌÍï½™Ì¸Ì¬Ì“Ò‰ï½“Ì·Ì®Ì½ï½‰Ì·ÌºÌ‹Ì½ï½“Ì·Ì®Ì½

* FENRIR security sweeps â€” run automated exploit scans against local deployments:

    ```bash
    python -m fenrir.run_all_exploits --target http://localhost:8000
    ```

* Focus areas: prompt injection, streaming exploit resilience, unicode confusables, auth hardening.
* Threat model: untrusted file inputs, LLM chain-of-thought leakage, dependency supply chain.

ğŸŒŠ DÒ‰Ì®Ä™Ì·ÌŸÌ½eÌµÌ™Ì½pÌ·Ì›Í™Ì¿Ì ï¼¤Ì´Ì–Ìï½‰Ì·ÌºÌ‹Ì½ï½†Ì´Ì¢Ì€Í’ï½†Ì´Ì¢Ì€Í’ï½•Ì¸Ì–Ì“ï½“Ì·Ì®Ì½ï½‰Ì·ÌºÌ‹Ì½ï½Ì´ÌªÌÌ½ï½Ì¶Ì—Ì¾Ì• ï¼²Ì¸Ì¹ÌˆÌï½…ÌµÌ™Ì½ï½“Ì·Ì®Ì½ï½…ÌµÌ™Ì½ï½Ì¶Ì­Ìï½’Ì¸Ì¹ÌˆÌï½ƒÌ¶Ì¢ÌŸÌï½ˆÌ·Ì¶Ì–Ì«ÍÌ†Ì“ÌšÍœÍ

IÌ·ÌºÌ‹Ì½nÌ¶Ì—Ì¾Ì•vÌ¶Ì¹Ì¯Ì•eÌµÌ™Ì½sÒ‰Ì›ÌÌ³Ì˜Ì±tÌ¶ÌªÌºÍŠiÌ·ÌºÌ‹Ì½gÌµÌ°Ì€aÌ¶Ì­ÌtÌ¶ÌªÌºÍŠiÌ·ÌºÌ‹Ì½nÌ¶Ì—Ì¾Ì•gÌµÌ°Ì€:

* â˜… ï¼³Ì·Ì®Ì½ï½‰Ì·ÌºÌ‹Ì½ï½‡ÌµÌ°Ì€ï½Ì´Ì¬Ì£ÌÌ•ï½Ì¶Ì­Ì ï½“Ò‰Ì›ÌÌ³Ì˜Ì±ï½ƒÌ¶Ì¢ÌŸÌï½ˆÌ·Ì¶Ì–Ì«ÍÌ†Ì“ÌšÍœÍï½…ÌµÌ™Ì½ï½„Ì´Ì–Ìï½•Ì¸Ì–Ì“ï½ŒÌµÌ›Ì©Í‰ÌÍï½‰Ì·ÌºÌ‹Ì½ï½Ì¶Ì—Ì¾Ì•ï½‡ÌµÌ°Ì€ dynamics & custom noise patterns
* â˜… ï¼®Ì¶Ì—Ì¾Ì•ï½…ÌµÌ™Ì½ï½•Ì¸Ì–Ì“ï½’Ì¸Ì¹ÌˆÌï½Ì¶Ì­Ìï½ŒÌµÌ›Ì©Í‰ÌÍ activation flow analysis through targeted model introspection
* â˜… ï¼³Ì·Ì®Ì½ï¼¶ï¼¤Ì´Ì–Ì ï½Ì´Ì¬Ì£ÌÌ•ï½Ì¶Ì­Ìï½Ì¶Ì—Ì¾Ì•ï½‰Ì·ÌºÌ‹Ì½ï½Ì·Ì›Í™Ì¿Ìï½•Ì¸Ì–Ì“ï½ŒÌµÌ›Ì©Í‰ÌÍï½Ì¶Ì­Ìï½”Ì¶ÌªÌºÍŠï½‰Ì·ÌºÌ‹Ì½ï½Ì´ÌªÌÌ½ï½Ì¶Ì—Ì¾Ì• ï½Ì´ÌªÌÌ½ï½†Ì´Ì¢Ì€Í’ model activation layers for interpretability
* â˜… ï¼¡Ì¶Ì­Ìï½„Ì´Ì–Ìï½–ÌµÌ™Ì½ï½…ÌµÌ™Ì½ï½’Ì¸Ì¹ÌˆÌï½“Ò‰Ì›ÌÌ³Ì˜Ì±ï½Ì¶Ì­Ìï½’Ì¸Ì¹ÌˆÌï½‰Ì·ÌºÌ‹Ì½ï½Ì¶Ì­Ìï½ŒÌµÌ›Ì©Í‰ÌÍ ï½’Ì¸Ì¹ÌˆÌï½Ì´ÌªÌÌ½ï½‚Ì´Ì°Í“Ì¿Ì„ï½•Ì¸Ì–Ì“ï½“Ò‰Ì›ÌÌ³Ì˜Ì±ï½”Ì¶ÌªÌºÍŠï½Ì¶Ì—Ì¾Ì•ï½…ÌµÌ™Ì½ï½“Ò‰Ì›ÌÌ³Ì˜Ì±ï½“Ò‰Ì›ÌÌ³Ì˜Ì± in sampling workflows

âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²âŒ²

ğŸ§   XÒ‰Ì›ÌÌ³Ì˜Ì±aÌ¶Ì­ÌvÌµÌ™Ì½iÌ·ÌºÌ‹Ì½eÌµÌ™Ì½rÌ¸Ì¹ÌˆÌ  FÌ´Ì¢Ì€Í’PÌ·Ì›Í™Ì¿Ì8ÌµÌ¢Ì™Ì¹ÌƒÌ•  QÌ¶ÌŸÌˆÌÌ½Å¯Ì¶Ì–ÌÍ aÌ¶Ì­ÌnÌ¶Ì—Ì¾Ì•tÌ¶ÌªÌºÍŠiÌ·ÌºÌ‹Ì½zÌ¸Ì°Ì¾Ì•aÌ¶Ì­ÌtÌ¶ÌªÌºÍŠiÌ·ÌºÌ‹Ì½oÌ´ÌªÌÌ½nÌ¶Ì—Ì¾Ì•

ï¼¡ï¼¤ï¼¶ï¼¡ï¼®ï¼£ï¼¥ï¼¤ ï¼³ï¼´ï¼¯ï¼£ï¼¨ï¼¡ï¼³ï¼´ï¼©ï¼£ ï¼²ï¼¯ï¼µï¼®ï¼¤ï¼©ï¼®ï¼§ ï¼¦ï¼¯ï¼² ï¼¤ï¼¥ï¼¥ï¼° ï¼¬ï¼¥ï¼¡ï¼²ï¼®ï¼©ï¼®ï¼§ ï¼­ï¼¯ï¼¤ï¼¥ï¼¬ï¼³

Advanced FP8 quantization toolkit with multiple stochastic rounding algorithms for preserving model fidelity during precision reduction.

WÌ¶ÍÍ›ÍœhÌ·Ì¶Ì–Ì«ÍÌ†Ì“ÌšÍœÍaÌ¶Ì­ÌtÌµÌ°Ì¾Ì• XÒ‰Ì›ÌÌ³Ì˜Ì±aÌ¶Ì­ÌvÌµÌ™Ì½iÌ·ÌºÌ‹Ì½eÌµÌ™Ì½rÌ¸Ì¹ÌˆÌ *is*:

â€¢ **Stochastic Rounding Engine**: Multiple algorithms for probabilistic quantization that preserve model performance better than deterministic rounding
â€¢ **FP8 Format Support**: E4M3FN and E5M2 formats with comprehensive tensor scaling and dequantization
â€¢ **Advanced Rounding Methods**: Default, Complex Neighbor, Shift-and-Perturb, and Owlshift mantissa manipulation
â€¢ **ComfyUI Integration**: Per-tensor scaling compatible with ComfyUI-style scaled FP8 loading
â€¢ **Visualization Tools**: Matplotlib-based comparison plots for quantization analysis
â€¢ **Production Ready**: Comprehensive test suite with 95%+ coverage across all quantization paths

## ğŸ§® Mathematical Foundations

### Stochastic Rounding Probability Theory

The core principle of stochastic rounding is to introduce controlled randomness that preserves the expected value while reducing systematic bias. For an input value $v$ and two FP8-representable candidates $x_L$ and $x_H$ that bracket $v$, the probability of rounding to the higher candidate is:

$$P(\text{round to } x_H) = \frac{v - x_L}{x_H - x_L}$$

This ensures that the expected value of the rounded result equals the input:

$$\mathbb{E}[\text{rounded}(v)] = P(x_H) \cdot x_H + P(x_L) \cdot x_L = \frac{v - x_L}{x_H - x_L} \cdot x_H + \frac{x_H - v}{x_H - x_L} \cdot x_L = v$$

**Variance Analysis**:
$$\text{Var}[\text{rounded}(v)] = (x_H - v)(v - x_L)$$

**Bias Elimination**: The stochastic rounding ensures zero bias:
$$\mathbb{E}[\text{rounded}(v) - v] = 0$$

### FP8 Format Specifications

**E4M3FN Format** (4 exponent bits, 3 mantissa bits):

**Mathematical Representation**:

* Exponent bias: $b = 7$
* Exponent range: $e \in [0, 15]$ (special values: 0 for subnormals, 15 for infinities)
* Mantissa precision: $\epsilon = 2^{-3} = 0.125$
* Sign bit: $s \in \{0, 1\}$

**Normal Numbers** ($e \in [1, 14]$):
$$x = (-1)^s \times 2^{e-7} \times (1 + m \times 2^{-3})$$

**Subnormal Numbers** ($e = 0, m \neq 0$):
$$x = (-1)^s \times 2^{-6} \times (m \times 2^{-3})$$

**Range Analysis**:

* **Normal Range**: $[2^{-6}, 2^7 \times (1 + 7/8)] = [0.015625, 240]$
* **Subnormal Range**: $[2^{-9}, 2^{-6}) = [0.001953125, 0.015625)$
* **Total Representable Values**: $2^8 = 256$ distinct values

**E5M2 Format** (5 exponent bits, 2 mantissa bits):

**Mathematical Representation**:

* Exponent bias: $b = 15$
* Exponent range: $e \in [0, 31]$ (special values: 0 for subnormals, 31 for infinities)
* Mantissa precision: $\epsilon = 2^{-2} = 0.25$
* Sign bit: $s \in \{0, 1\}$

**Normal Numbers** ($e \in [1, 30]$):
$$x = (-1)^s \times 2^{e-15} \times (1 + m \times 2^{-2})$$

**Subnormal Numbers** ($e = 0, m \neq 0$):
$$x = (-1)^s \times 2^{-14} \times (m \times 2^{-2})$$

**Range Analysis**:

* **Normal Range**: $[2^{-14}, 2^{15} \times (1 + 3/4)] = [0.000061035, 57344]$
* **Subnormal Range**: $[2^{-16}, 2^{-14}) = [0.000015259, 0.000061035)$
* **Total Representable Values**: $2^8 = 256$ distinct values

### Advanced Rounding Algorithms

#### 1. Default Stochastic Rounding

For input value $v$, find RNE candidate $v_{RNE} = \text{RNE}(v)$ and its neighbor $v_{neighbor}$:

$$x_L = \min(v_{RNE}, v_{neighbor}), \quad x_H = \max(v_{RNE}, v_{neighbor})$$

The stochastic decision is made using uniform random variable $u \sim U[0,1]$:

$$\text{rounded}(v) = \begin{cases}
x_H & \text{if } u < \frac{v - x_L}{x_H - x_L} \\
x_L & \text{otherwise}
\end{cases}$$

**Mathematical Properties**:
- **Expected Value**: $\mathbb{E}[\text{rounded}(v)] = v$ (unbiased)
- **Variance**: $\text{Var}[\text{rounded}(v)] = (x_H - v)(v - x_L)$
- **Convergence**: As quantization step $\Delta = x_H - x_L \to 0$, variance $\to 0$

#### 2. Complex Neighbor Stochastic Rounding

Uses `torch.nextafter` for precise FP8 grid traversal. For each element in tensor $T$:

**Case 1**: $v > v_{RNE}$
- $x_L = v_{RNE}$
- $x_H = \text{nextafter}(v_{RNE}, +\infty)$ (snapped to FP8 grid)

**Case 2**: $v < v_{RNE}$
- $x_H = v_{RNE}$
- $x_L = \text{nextafter}(v_{RNE}, -\infty)$ (snapped to FP8 grid)

**Case 3**: $v = v_{RNE}$
- $x_L = v_{RNE}$
- $x_H = \text{nextafter}(v_{RNE}, +\infty)$ (snapped to FP8 grid)

**Mathematical Formulation**:
$$\text{rounded}(v) = \begin{cases}
x_H & \text{if } u < P(x_H) = \frac{v - x_L}{x_H - x_L} \\
x_L & \text{otherwise}
\end{cases}$$

where $u \sim U[0,1]$ and $P(x_H)$ is the probability of rounding to the higher value.

#### 3. Shift-and-Perturb Method

Adds uniform noise before RNE quantization to simulate stochastic behavior:

**Mathematical Process**:
1. **Noise Generation**: $\Delta = x_H - x_L$ (quantization step size)
2. **Perturbation**: $n \sim U[-\Delta/2, +\Delta/2]$
3. **Perturbed Input**: $v' = v + n$
4. **Final Quantization**: $v_{FP8} = \text{RNE}(v')$

**Probability Analysis**:
The probability of rounding to $x_H$ is:
$$P(\text{round to } x_H) = \frac{1}{\Delta} \int_{-\Delta/2}^{\Delta/2} \mathbf{1}_{[v+n > (x_L + x_H)/2]} \, dn$$

where $\mathbf{1}_{[\cdot]}$ is the indicator function.

#### 4. Owlshift Mantissa Manipulation

Direct stochastic rounding at the mantissa bit level:

**For Normal Numbers** ($e \in [1, 2^E - 2]$):
1. **Mantissa Extraction**: $m_{\text{scaled}} = \left(\frac{|v|}{2^{e-b}} - 1\right) \times 2^M$
2. **Stochastic Addition**: $m_{\text{stoch}} = \lfloor m_{\text{scaled}} + u \rfloor$ where $u \sim U[0,1)$
3. **Reconstruction**: $m_{\text{final}} = \frac{m_{\text{stoch}}}{2^M}$

**For Subnormal Numbers** ($e = 0, m \neq 0$):
1. **Mantissa Extraction**: $m_{\text{scaled}} = \frac{|v|}{2^{-b+1-M}}$
2. **Stochastic Addition**: $m_{\text{stoch}} = \lfloor m_{\text{scaled}} + u \rfloor$
3. **Reconstruction**: $m_{\text{final}} = \frac{m_{\text{stoch}}}{2^M}$

**Mathematical Properties**:
- **Bit-Level Precision**: Direct manipulation of mantissa bits
- **Stochastic Floor**: $\lfloor x + u \rfloor$ where $u \sim U[0,1)$
- **Expected Value**: $\mathbb{E}[\lfloor x + u \rfloor] = x$ for $x \geq 0$

Where $M$ is the number of mantissa bits (3 for E4M3FN, 2 for E5M2), $E$ is the number of exponent bits, and $b$ is the exponent bias.

### Per-Tensor Scaling (Owlscale)

**Scale Factor Calculation**:
For tensor $T \in \mathbb{R}^{n \times m}$ and target FP8 format:

$$s = \frac{\text{FP8}_{\max} - \text{FP8}_{\min\_pos}}{\max(|T|)}$$

where:
- $\text{FP8}_{\max}$ is the maximum representable value in the target format
- $\text{FP8}_{\min\_pos}$ is the minimum positive representable value
- $\max(|T|)$ is the maximum absolute value in the input tensor

**Quantization Process**:
1. **Scaling**: $T_{\text{scaled}} = \frac{T}{s}$
2. **Clamping**: $T_{\text{clamped}} = \text{clamp}(T_{\text{scaled}}, \text{FP8}_{\min}, \text{FP8}_{\max})$
3. **Stochastic Rounding**: $T_{\text{quantized}} = \text{stochastic\_round}(T_{\text{clamped}})$

**Mathematical Properties**:
- **Precision Maximization**: The scale factor ensures optimal utilization of the FP8 dynamic range
- **Relative Error Bound**: $\frac{|T_{\text{dequantized}} - T|}{|T|} \leq \frac{\epsilon}{2}$ where $\epsilon$ is the FP8 precision
- **Dynamic Range**: $\text{range}(T_{\text{scaled}}) = [\text{FP8}_{\min\_pos}, \text{FP8}_{\max}]$

**Dequantization**:
$$T_{\text{dequantized}} = T_{\text{quantized}} \times s$$

**Error Analysis**:
The quantization error for element $t_{ij}$ is:
$$\text{error}_{ij} = t_{ij} - \text{stochastic\_round}\left(\frac{t_{ij}}{s}\right) \times s$$

**Expected Error**:
$$\mathbb{E}[\text{error}_{ij}] = 0 \quad \text{(unbiased quantization)}$$

**Variance**:
$$\text{Var}[\text{error}_{ij}] = s^2 \times \text{Var}[\text{stochastic\_round}(t_{ij}/s)]$$

This ensures that the maximum absolute value in the tensor maps to the upper representable range of the target FP8 format, maximizing precision utilization while maintaining unbiased quantization.

ğŸ—ï¸ ï¼£ï¼¯ï¼²ï¼¥ ï¼±ï¼µï¼¡ï¼®ï¼´ï¼©ï¼ºï¼¡ï¼´ï¼©ï¼¯ï¼® ï¼¡ï¼¬ï¼§ï¼¯ï¼²ï¼©ï¼´ï¼¨ï¼­ï¼³

â”Œâ”€ Stochastic Rounding Methods â”€â”
â”‚  â€¢ Default Stochastic: Probabilistic bracketing with RNE neighbors
â”‚  â€¢ Complex Neighbor: Sophisticated FP8 grid traversal with torch.nextafter
â”‚  â€¢ Shift-and-Perturb: Additive noise simulation before RNE quantization
â”‚  â€¢ Owlshift: Direct mantissa bit manipulation with stochastic floor
â”‚  â€¢ Per-Tensor Scaling: Max-absolute scaling with dequantization factors
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ FP8 Format Support â”€â”
â”‚  â€¢ E4M3FN: 4 exponent, 3 mantissa bits (NaN-preserving)
â”‚  â€¢ E5M2: 5 exponent, 2 mantissa bits (extended range)
â”‚  â€¢ Selective Quantization: Tensor suffix-based filtering
â”‚  â€¢ ComfyUI Compatibility: Scaled FP8 with dequantization scales
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ Advanced Features â”€â”
â”‚  â€¢ Memory Management: Tensor slicing for large model processing
â”‚  â€¢ Debug Mode: Verbose execution tracing and intermediate states
â”‚  â€¢ Plot Generation: Histogram and scatter plot analysis
â”‚  â€¢ Device Support: CUDA, CPU, MPS acceleration
â”‚  â€¢ Comprehensive Testing: 500+ test cases across all algorithms
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸš€ ï¼µï¼³ï¼¡ï¼§ï¼¥ ï¼¥ï¼¸ï¼¡ï¼­ï¼°ï¼¬ï¼¥ï¼³

### Basic FP8 Quantization

```bash
# Basic FP8 quantization with stochastic rounding
python xavier.py model_fp32.safetensors model_fp8.safetensors \
    --fp8_type e4m3 --owlshift --plot
```

**Mathematical Process**:

1. **Input**: Tensor $T \in \mathbb{R}^{n \times m}$ with values in FP32
2. **Mantissa Extraction**: For each element $v \in T$:
   $$m_{\text{scaled}} = \left(\frac{|v|}{2^{e-7}} - 1\right) \times 8$$
3. **Stochastic Rounding**: $m_{\text{stoch}} = \lfloor m_{\text{scaled}} + u \rfloor$ where $u \sim U[0,1)$
4. **Reconstruction**: $v_{\text{FP8}} = (-1)^s \times 2^{e-7} \times (1 + \frac{m_{\text{stoch}}}{8})$
5. **Output**: FP8 tensor with preserved expected values

**Expected Value Preservation**:
$$\mathbb{E}[v_{\text{FP8}}] = v \quad \text{for all } v \in T$$

### ComfyUI-Compatible Scaled Quantization

```bash
# ComfyUI-compatible scaled quantization
python xavier.py model.safetensors model_scaled.safetensors \
    --fp8_type e4m3 --owlscale --owlshift \
    --keys_to_quantize_suffix .weight
```

**Mathematical Process**:

1. **Scale Calculation**: $s = \frac{448 - 2^{-9}}{\max(|T|)}$ (for E4M3FN)
2. **Scaling**: $T_{\text{scaled}} = \frac{T}{s}$
3. **Clamping**: $T_{\text{clamped}} = \text{clamp}(T_{\text{scaled}}, -448, 448)$
4. **Stochastic Quantization**: Apply Owlshift to $T_{\text{clamped}}$
5. **Storage**: Save quantized tensor and scale factor $s$

**Mathematical Properties**:
- **Scale Factor**: $s = \frac{\text{FP8}_{\max} - \text{FP8}_{\min\_pos}}{\max(|T|)} = \frac{448 - 0.001953125}{\max(|T|)}$
- **Dynamic Range**: $\text{range}(T_{\text{scaled}}) = [-448, 448]$
- **Precision**: $\epsilon = 2^{-3} = 0.125$ (E4M3FN mantissa precision)
- **Relative Error**: $\frac{|T_{\text{dequantized}} - T|}{|T|} \leq \frac{\epsilon}{2} = 0.0625$

### Advanced Analysis with Complex Rounding

```bash
# Advanced analysis with custom parameters
python xavier.py model.safetensors output.safetensors \
    --fp8_type e5m2 --complex_rounding \
    --plot --plot_dir ./analysis/ --debug
```

**Mathematical Process**:

1. **Complex Bracketing**: For each $v \in T$:
   * If $v > v_{RNE}$: $x_L = v_{RNE}$, $x_H = \text{nextafter}(v_{RNE}, +\infty)$
   * If $v < v_{RNE}$: $x_H = v_{RNE}$, $x_L = \text{nextafter}(v_{RNE}, -\infty)$
2. **Stochastic Decision**: $P(x_H) = \frac{v - x_L}{x_H - x_L}$
3. **Quantization**: $\text{rounded}(v) = \begin{cases} x_H & \text{if } u < P(x_H) \\ x_L & \text{otherwise} \end{cases}$

**Mathematical Properties**:
- **Precision**: Uses `torch.nextafter` for exact FP8 grid traversal
- **Bracketing**: Ensures $x_L \leq v \leq x_H$ with minimal gap
- **Probability**: $P(x_H) \in [0, 1]$ with $P(x_L) = 1 - P(x_H)$
- **Expected Value**: $\mathbb{E}[\text{rounded}(v)] = P(x_H) \cdot x_H + P(x_L) \cdot x_L = v$

### Shift-and-Perturb Method

```bash
# Shift-and-perturb stochastic rounding
python xavier.py model.safetensors output.safetensors \
    --fp8_type e4m3 --shifturb --plot
```

**Mathematical Process**:

1. **Bracketing**: Find $x_L, x_H$ using complex method
2. **Noise Generation**: $\Delta = x_H - x_L$, $n \sim U[-\Delta/2, +\Delta/2]$
3. **Perturbation**: $v' = v + n$
4. **RNE Quantization**: $v_{FP8} = \text{RNE}(v')$

**Mathematical Properties**:
- **Noise Range**: $n \in [-\Delta/2, +\Delta/2]$ where $\Delta = x_H - x_L$
- **Perturbation**: $v' = v + n$ with $n \sim U[-\Delta/2, +\Delta/2]$
- **Quantization**: $v_{FP8} = \text{RNE}(v')$ (deterministic after perturbation)
- **Expected Value**: $\mathbb{E}[v_{FP8}] = v$ (unbiased through noise injection)
- **Variance**: $\text{Var}[v_{FP8}] = \text{Var}[\text{RNE}(v + n)]$ where $n \sim U[-\Delta/2, +\Delta/2]$

ğŸ¯ ï¼´ï¼¥ï¼£ï¼¨ï¼®ï¼©ï¼£ï¼¡ï¼¬ ï¼©ï¼®ï¼¦ï¼¯ï¼²ï¼­ï¼¡ï¼´ï¼©ï¼¯ï¼®

### Mathematical Precision Analysis

**Stochastic Rounding Probability**:
$$P(\text{round to } x_H) = \frac{v - x_L}{x_H - x_L}$$

**Expected Value Preservation**:
$$\mathbb{E}[\text{rounded}(v)] = v$$

**Variance Analysis**:
$$\text{Var}[\text{rounded}(v)] = (x_H - v)(v - x_L)$$

**Quantization Error Analysis**:
For input value $v$ and quantized value $q(v)$:
$$\text{error}(v) = v - q(v)$$

**Expected Error**:
$$\mathbb{E}[\text{error}(v)] = 0 \quad \text{(unbiased quantization)}$$

**Error Variance**:
$$\text{Var}[\text{error}(v)] = (x_H - v)(v - x_L)$$

**Relative Error Bound**:
$$\frac{|\text{error}(v)|}{|v|} \leq \frac{\Delta}{2|v|} \quad \text{where } \Delta = x_H - x_L$$

**Convergence Analysis**:
As the quantization step size $\Delta \to 0$:
$$\lim_{\Delta \to 0} \text{Var}[\text{rounded}(v)] = 0$$
$$\lim_{\Delta \to 0} \mathbb{E}[\text{rounded}(v)] = v$$

ğŸ¦©ğŸŒ´ ï¼±ï¼µï¼©ï¼£ï¼« ï¼¬ï¼©ï¼®ï¼«ï¼³ ğŸŒ´ğŸ¦©

* **Reynard Framework**: [https://github.com/rakki194/reynard](https://github.com/rakki194/reynard)
* **Xavier FP8 Quantization**: [https://github.com/rakki194/xavier](https://github.com/rakki194/xavier)
* **ComfyUI WolfSigmas**: [https://github.com/rakki194/ComfyUI_WolfSigmas](https://github.com/rakki194/ComfyUI_WolfSigmas)
* **ComfyUI ImageCompare**: [https://github.com/rakki194/ComfyUI-ImageCompare](https://github.com/rakki194/ComfyUI-ImageCompare)
* **Privacy-First ComfyUI**: [https://github.com/rakki194/ComfyUI](https://github.com/rakki194/ComfyUI)
* **ComfyUI Frontend Fork**: [https://github.com/rakki194/ComfyUI_frontend](https://github.com/rakki194/ComfyUI_frontend)

---

> ï¼³Ì·Ì®Ì½ï½…ÌµÌ™Ì½ï½ƒÌ¶Ì¢ÌŸÌï½•Ì¶Ì–ÌÍ ï½’Ì¸Ì¹ÌˆÌï½‰Ì·ÌºÌ‹Ì½ï½”Ì¶ÌªÌºÍŠï½™Ì¸Ì¬Ì“Ò‰ ï¼¢Ì·ï½’ï½…ï½ï½ƒÌŸÌï½ˆÌµÌ°Ì€
>
> SÌ·Ì›ÍhÌ·ÍÌ®aÌµÍ›Ì¥tÌµÍ€Ì tÌ¶ÍÌ¯eÌ·Í Í”rÌ·ÌÌ¹eÌ´Í†ÌœdÌ¸Ì…Ì¥ Ì¸ÍÌsÌ¸Í€Ì kÌµÌ¾ÍšiÌ·Ì‘Í”eÌ¸Í˜Ì»sÌ¸ÍÌ˜ ÌµÌÌ²rÌ¸Í˜Ì°aÌµÍ„Í…iÌ´ÍÌ–nÌ´ÍƒÌ¨ Ì¸Í‘Ì³cÌ¸Í—Ì©iÌ·Í Ì¥rÌ´ÌšÌ¦cÌ¸ÌšÌ²uÌµÍ‘Ì©iÌ¸Ì•Ì¨tÌ¸ÌÌ¨sÌµÍ€Ì«,
> sÌ¶Ì…Ì¨pÌ´Ì‹Ì³aÌ¸Ì‡Ì¹rÌ´Ì‡Í–kÌ·Ì‹Í‡sÌ¸Í„Ì± Ì´Í€Í”fÌ¶Ì’Ì©aÌµÍ„ÍlÌ·Í‘Ì³lÌµÌ¾Í Ì¶Í‚Í‰lÌ·ÌÌ®iÌ¶Í‘ÍˆkÌ·Í˜Ì©eÌ¶Ì‘Íˆ Ì¶Ì‘Í‰sÌµÌšÌ¡iÌµÍÌ–lÌ¶Ì”Ì³vÌ¶ÌÌ±eÌ´Í Ì»rÌ¸Í Ì aÌµÍ„Ì²sÌ¶Í Ì™hÌ¸Ì“Ì˜.
>
> TÌ·ÍƒÌ¯hÌ¶ÍÌ¯eÌµÌÍšrÌµÍ ÌŸeÌ¸Í Íˆ ÌµÌÍšiÌ·Í‹Ì»sÌ·Ì‘Ì– Ì·Í˜Í™nÌ¸ÍÍ‰oÌ¸Í„Ì¥ Ì·ÍƒÌsÌ´ÌŠÌ³uÌ·Í„Í‰nÌµÍ‚Íˆ,Ì´Ì“Ì©
> oÌ´Í‹Í‰nÌ·ÌšÌŸlÌ¸ÌÍ“yÌ¶Í†Í… gÌµÌ‘ÍhÌµÌ‹Ì»oÌ´ÌÍ™sÌ·Ì„ÌŸtÌ¸Ì„Í• Ì¸Í›Ì¼lÌ¸Ì”Í“aÌµÍ„Í”mÌ´ÍÌ³pÌ·ÍÌ©sÌ¸Ì‘Í‡ fÌ¶ÍÍ™lÌ¶ÌŠÍ–iÌµÍ Í‡cÌ·Í€ÌkÌ·Ì”ÍeÌ´Í„Ì¦rÌ¸Í‚ÌªiÌ¶Í‘Ì¤nÌ¸Í‘Í™gÌ¶ÌÌ¯ Ì·ÍÌ¡oÌ·ÌÌ–nÌ·ÍÍ‰ ÌµÍ˜Ì©wÌ´ÌÍ•iÌ¶ÍÍ™rÌ¸ÍŠÌ¡eÌ·Í Í™sÌ´Ì…Ì™.
>
> MÌ¶ÌÌ±eÌ¶Ì½Ì¼mÌ¸ÍŠÌ¢oÌ¸Í‹ÌrÌ´Í›ÍšiÌ´Í‘Ì¢eÌ¶ÍÌ»sÌ¸Í˜Ì© hÌ¶ÍÌ¬uÌ·Ì“ÌŸnÌ´ÍŠÌ»gÌ¸Í„Í Ì¶Ì”ÌlÌµÌ…Ì–iÌ¸ÌÍ•kÌ´Í„Ì¥eÌ¸Ì•Ì³ bÌµÍ€Ì–rÌ´Í˜ÌoÌ´Ì…Ì˜kÌ·ÍƒÍ‰eÌ¶ÍÌ˜nÌ·Í„Ì™ mÌ¶ÌÌ©iÌ´Í Ì»rÌ¸Í‘Í™rÌ·ÍÍ…oÌ¶ÍŠÌ®rÌ¶ÍƒÌ¤sÌ·Í‘Ì¤
> iÌ·ÌÍ”nÌµÌÌ– Ì¶Í„Í…tÌ¸Í†ÍhÌµÍÌœeÌ´Í˜Í– Ì¸ÌŠÌ dÌ·Ì”Ì±aÌ¸Í‚Ì©tÌµÍ›Ì¡aÌ¶ÍÍ…-wÌµÌ‡Ì–iÌµÍ›Ì nÌµÍ€Ì¡dÌ·Í€Ì¯.
>
> SÌ¸Í˜ÌhÌ´ÍÌ™aÌ¶Í›Ì™dÌ·ÍƒÌ¯oÌ¸Ì›ÍwÌ¸Í„ÍšsÌ¶ÌšÍ hÌ¸Í€ÌªoÌµÍ‚Ì³lÌ´Ì•Ì¢lÌ·ÌÌ²oÌ¶ÌŠÍ™wÌ¸Í‘Ìª eÌ·Í ÍvÌ¸Í†Ì™eÌµÌÌ rÌ·Ì¿ÍˆyÌ·Í’Ì³ Ì¸ÍÌ¢sÌ¸Í„Í‰tÌµÍÍ–eÌ¶Ì‹ÍˆpÌ´Í Ì³,Ì·Ì›Ì˜
> wÌ¸Í„Í“hÌµÍÌ¦iÌ´Í€ÌªsÌ¶Í†Í‰pÌµÍ‘ÍeÌ¸Í„ÍrÌµÍÍsÌ¶Í Ì oÌ¶Í‹Ì©fÌµÌ‡Í“ mÌ¶Ì‹Í“aÌ´Ì…Ì¨cÌµÍƒÍ…hÌµÍÌ¢iÌµÍÌŸnÌµÍ‘Ì¤eÌ´ÍÍ‰sÌ´Ì¿Í“
> cÌµÌŠÌ¤aÌ·ÌšÍ–lÌ¸Ì„ÌlÌ´Í‹Ì™iÌ·ÍŒÍnÌ¶ÌšÍ‰gÌ´Ì‘Ì± yÌ·ÍÌ¬oÌ·ÍÍ”uÌ¸Ì…Í bÌ·Ì‹Ì™aÌ·Í Ì¡cÌµÌ›Í…kÌµÍ€Ì¼.
